let m_key,m_iv,enc;function abs_url(e){let t=document.createElement("a");return t.href=e,t.href}function progress(e,t,n){const o=t/e*100;o>=100&&(document.getElementById("filact").innerText="complete"),document.getElementById("rdf").style.display="block",document.getElementById("filact").innerText=`${n} file`,document.getElementById("progress-div").style.width=`${o}%`}async function send_file(e,t,n){const o=new XMLHttpRequest,a=e.iv,r=e.key;function c(e,t){e.select(),document.execCommand("copy"),t&&(t.innerHTML="copied")}o.open("POST","/upload/"),o.upload.onprogress=(e=>{progress(e.total,e.loaded,"Uploading")}),o.onload=function(){document.getElementById("filact").innerText="Complete";const e=JSON.parse(this.response),t=(e.nonce,e.file),n=`/dl/${a}/${encodeURIComponent(t)}/`;window.history.pushState({},document.title,n),document.getElementById("xrhf").style.display="block";const o=abs_url(n),s=document.getElementById("file-url"),i=document.getElementById("file-url_input"),l=document.getElementById("file-url_helper"),d=document.getElementById("pass-key"),y=document.getElementById("pass-key_helper"),u=document.getElementById("pass-key_input"),p=document.getElementById("copyall"),m=document.getElementById("copy-all_input"),g=document.getElementById("copy-all_helper");document.getElementById("fname").innerHTML=t,s.innerHTML=o,i.value=o,d.innerHTML=r,u.value=r,m.value=`${o}?!=${encodeURIComponent(r)}`,p.onclick=(()=>{c(m,g)}),s.onclick=(()=>{c(i,l)}),d.onclick=(()=>{c(u,y)})},o.send(t)}function processFile(e){const t=e.target.files[0],n=t.type,o=t.name,a=new FileReader;a.onprogress=(e=>{progress(e.total,e.loaded,"Reading")}),a.onload=(async e=>{const t=e.target.result,a=crypto.getRandomValues(new Uint8Array(16));m_iv=a;const r=await crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]);m_key=await crypto.subtle.exportKey("raw",r),enc=await crypto.subtle.encrypt({name:"AES-CBC",iv:a},r,t),send_file(await fetch_text_keys(m_key,m_iv),enc,n,o)}),a.readAsArrayBuffer(t)}function arrayBufferToBase64(e){return new Promise((t,n)=>{const o=new Blob([e],{type:"application/octet-binary"}),a=new FileReader;a.onload=(e=>{const n=e.target.result;t(n.substr(n.indexOf(",")+1))}),a.readAsDataURL(o)})}async function base64ToArrayBuffer(e){const t=await fetch(`data:application/octect-stream;base64,${e}`);return await t.arrayBuffer()}async function fetch_text_keys(e,t){return{key:await arrayBufferToBase64(e),iv:await arrayBufferToBase64(t)}}function read_mime_type(e){const t={"89504E47":"image/png",47494638:"image/gif",25504446:"application/pdf",FFD8FFDB:"image/jpeg",FFD8FFE0:"image/jpeg","504B0304":"application/zip"};return new Promise((n,o)=>{const a=new FileReader;a.onloadend=(e=>{if(e.target.readyState===FileReader.DONE){let o=[];new Uint8Array(e.target.result).forEach(e=>{o.push(e.toString(16))});const a=o.join("").toUpperCase();n(t[a])}}),a.onerror=(e=>{reject(e)}),a.readAsArrayBuffer(e)})}async function get_mime_type(e,t=4){const n=e.slice(0,t);return data=await read_mime_type(n),data}function parseqs(e=window.location.search){const t={};e="?"==e[0]?e.substring(1):e;const n=(e=decodeURI(e)).split("&");for(let e=0;e<n.length;e++){const o=n[e].split("=");t[o[0]]=decodeURIComponent(o[1])}return t}class FileDecryptor{constructor(e){this.key=e||(()=>parseqs()["!"]),this.constants=document.getElementById("constants")||{},this.iv=constants.getAttribute("data-js_iv"),this.filename=constants.getAttribute("data-filename"),this._get_iv_as_buffer=(async e=>{return await base64ToArrayBuffer(e)}),this._get_crypto=(async e=>{const t=await base64ToArrayBuffer(e);return await crypto.subtle.importKey("raw",t,"AES-CBC",!0,["encrypt","decrypt"])}),this.get_data=(async()=>{const e=this.key()||window.__newkey__;if(!e)return!1;const t=await this._get_crypto(e),n=this.iv;return{key:t,iv:await this._get_iv_as_buffer(n)}}),this.decrypt=(async(e,t)=>{const n=e.key,o=e.iv,a=await crypto.subtle.decrypt({name:"AES-CBC",iv:o},n,t),r=new Blob([a]);return new Blob([a],{type:await get_mime_type(r)})})}}function enter_input(e){const t=document.getElementById("keyval"),n=document.getElementById("keybtn"),o=document.getElementById("get-key");o.style.display="block",n.addEventListener("click",()=>{window.__key__=decodeURIComponent(t.value),o.style.display="none",window.location.search=`?!=${encodeURIComponent(t.value)}`})}async function _decrypt(e){const t=new FileDecryptor,n=t.key();if(console.log(n),!n)return enter_input();try{const n=e||await use_decryptor(t);if(!n)throw Error();const o=await t.decrypt(n.data,n.enc),a=URL.createObjectURL(o);return document.getElementById("download-link").style.display="block",document.getElementById("dl-a").href=a,!0}catch(e){console.log(e),enter_input(n)}}function use_decryptor(e){return new Promise((t,n)=>{document.getElementById("progrs").style.display="block",e.get_data().then(n=>{n||t(null);const o=e.filename,a=new XMLHttpRequest;document.getElementById("dl-a").download=o,a.open("GET",`/get~file?f=${encodeURIComponent(o)}`),a.responseType="arraybuffer",a.onprogress=(e=>{const t=e.total;document.getElementById("progrs").style.display="block",document.getElementById("div_").innerHTML=`${(e.loaded/1048576).toFixed(2)} MB of ${(t/1048576).toFixed(2)} MB`,document.getElementById("progrs").style.width=`${e.loaded/1048576/(t/1048576)*100}%`}),a.onload=(e=>{document.getElementById("div_").innerHTML="Complete",document.getElementById("progrs").style.width="100%";const o=a.response;t({enc:o,data:n})}),a.send()})})}